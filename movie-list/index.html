<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Movie List</title>
  </head>
  <body>
    <header>
      <img src="slika.svg" alt="" />
    </header>
    <main>
      <div class="input">
        <form id="movie-form">
          <input type="text" id="title" placeholder="Title" required />
          <input type="number" id="year" placeholder="Year" required />
          <input
            type="number"
            id="stars"
            placeholder="Stars (1-5)"
            min="1"
            max="5"
            required
          />
          <button type="submit">Add</button>
        </form>
      </div>
      <div class="main">
        <ol id="movie-list" class="orderedLista" reversed></ol>
      </div>
    </main>

    <script>
      const SHEET_ID = "1F1kRE6jFEJ1afNnVs_oQsPY4U10mYDqx8ZKsmBm9h-k"; // replace with your Google Sheet ID
      const API_KEY = "AIzaSyAMCovOvuKON0pxJ-Os3zNaRqEw_s7v3Wo"; // replace with your API key
      const RANGE = "Sheet1!A:C"; // adjust to your sheet range
      const SHEETDB_URL = "https://sheetdb.io/api/v1/td9trtqqxuuon"; // for adding/editing

      // Fetch movies from Google Sheets API
      async function loadMovies() {
        const res = await fetch(
          `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`
        );
        const data = await res.json();
        const rows = data.values || [];
        const list = document.getElementById("movie-list");
        list.innerHTML = "";

        // skip header row
        rows
          .slice(1)
          .reverse()
          .forEach((row) => {
            const [title, year, stars] = row;
            let starIcons = "‚≠ê".repeat(parseInt(stars, 10));
            let li = document.createElement("li");
            li.innerHTML = `<div class=div-flex><div class="div-inline lijevi-div">${title} <span class="godina">[${year}]</span></div> <div class="div-inline stars"><span">${starIcons}</span></div><div>`;
            list.appendChild(li);
          });
      }

      // Add a new movie via SheetDB
      document
        .getElementById("movie-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const title = document.getElementById("title").value;
          const year = document.getElementById("year").value;
          const stars = document.getElementById("stars").value;

          await fetch(SHEETDB_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ data: [{ title, year, stars }] }),
          });

          e.target.reset();
          loadMovies(); // reload from Google Sheets API
        });

      // Initial load
      loadMovies();
    </script>
  </body>
</html>

